
services:

  nginx:
    image: nginx:alpine
    container_name: nginx-proxy
    ports:
      - "80:80"
    volumes:
      - ./conf/nginx.conf:/etc/nginx/nginx.conf
    depends_on:
      - oauth-proxy
      - ui-agent
      - mvp-agent
    restart: unless-stopped

  oauth-proxy:
    image: quay.io/oauth2-proxy/oauth2-proxy:latest
    container_name: oauth2-proxy
    ports:
      - "4180:4180"
    volumes:
      - ./conf/oauth2-proxy.cfg:/etc/oauth2-proxy/oauth2-proxy.cfg
    command: ["--config=/etc/oauth2-proxy/oauth2-proxy.cfg"]
    restart: unless-stopped

  ui-agent:
    build:
      context: ./ui-agent
      dockerfile: Dockerfile
    container_name: ui-agent-app
    ports:
      - "8000:8000"
    environment:
      - GOOGLE_API_KEY=${GOOGLE_API_KEY}
    volumes:
      - ./ui-agent/index.html:/root/index.html
      - ./ui-agent/demo.html:/root/demo.html
    restart: unless-stopped

  mvp-agent:
    build:
      context: ./mvp-agent
      dockerfile: Dockerfile
    container_name: mvp-agent-app
    ports:
      - "8001:8000"
    environment:
      - GOOGLE_API_KEY=${GOOGLE_API_KEY}
    volumes:
      - ./mvp-agent/ui:/app/ui
      - ./mvp-agent/data:/app/data
    restart: unless-stopped
